workflows:
  my-workflow:
    working_directory: php
    scripts:
      - name: Build jtraulle/php
        working_directory: php/8.1/8.1-fpm-alpine3.15
        script: |
          spctl --master-disable
          brew install --cask docker
          sudo /Applications/Docker.app/Contents/MacOS/Docker --unattended --install-privileged-components
          open -a /Applications/Docker.app --args --unattended --accept-license
          echo "Waiting for Docker to be ready..."
          while ! /Applications/Docker.app/Contents/Resources/bin/docker info &>/dev/null; do sleep 1; done
          docker build . -t jtraulle/php:8.1-fpm-alpine3.15-arm64
          spctl --master-enable
